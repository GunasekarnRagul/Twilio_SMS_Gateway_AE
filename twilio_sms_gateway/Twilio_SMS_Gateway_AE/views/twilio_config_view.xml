<odoo>
    <record id="view_twilio_config_form" model="ir.ui.view">
        <field name="name">twilio.config.form</field>
        <field name="model">twilio.config</field>
        <field name="arch" type="xml">
            <form string="Twilio Configuration">
                <header>
                    <button name="action_test_connection"
                        string="Test Connection"
                        type="object"
                        class="oe_highlight"
                        icon="fa-plug"
                        attrs="{'invisible': [('connection_status', '=', 'connected')]}" />
                    <field name="connection_status" widget="statusbar"
                        statusbar_visible="unknown,connected,failed" />

                    <button name="update_twilio_usage"
                        string="Refresh Stats"
                        type="object"
                        class="btn-link"
                        icon="fa-refresh"
                        attrs="{'invisible': [('connection_status', '!=', 'connected')]}" />
                </header>
                <sheet>
                    <widget name="web_ribbon" title="Connected" bg_color="bg-success"
                        attrs="{'invisible': [('connection_status', '!=', 'connected')]}" />
                    <widget name="web_ribbon" title="Disconnected" bg_color="bg-danger"
                        attrs="{'invisible': [('connection_status', '!=', 'failed')]}" />

                    <group attrs="{'invisible': [('connection_status', '=', 'connected')]}">
                        <div class="text-center mt-3" style="color:#666; width: 100%;">
                            <h2><i class="fa fa-cogs" /> Twilio Setup</h2>
                        </div>
                        <group>
                            <group string="API Credentials">
                                <field name="name" invisible="1" />
                                <field name="account_sid" placeholder="ACxxxxxxxxxxxxx" />
                                <field name="auth_token" password="True"
                                    placeholder="7aedxxxxxxxxxxxxx" />
                            </group>
                            <group string="Phone Numbers">
                                <field name="twilio_number" placeholder="+1234567890" />
                            </group>
                        </group>
                        <div class="alert alert-info text-center mt-3" style="width: 100%;">
                            <b>Tip:</b> Get credentials from <a href="https://console.twilio.com"
                                target="_blank">Twilio Console</a>. </div>
                    </group>

                    <div attrs="{'invisible': [('connection_status', '!=', 'connected')]}">
                        <div class="o_group"
                            style="border: 1px solid #ccc; border-radius: 10px; padding: 20px; background: #fff;">
                            <div
                                style="background: #28A745; color: white; padding: 15px; border-radius: 10px 10px 0 0; margin: -20px -20px 20px -20px;">
                                <h3 style="color: white; margin: 0;"><i class="fa fa-check-circle" />
                                    Twilio Active</h3>
                                <small>Connection verified successfully</small>
                            </div>

                            <div class="row">
                                <div class="col-6" style="border-right: 1px solid #eee;">
                                    <h4 class="text-primary"><i class="fa fa-bar-chart" /> Account
                                        Details</h4>
                                    <div class="mt-3">
                                        <strong>Account Name:</strong>
                                        <field name="account_name" />
                                    </div>
                                    <div class="mt-2">
                                        <strong>Account Type:</strong>
                                        <field name="account_type" />
                                    </div>
                                    <div class="mt-2">
                                        <strong>Balance:</strong>
                                        <span class="text-info font-weight-bold">
                                            <field name="account_balance" />
                                        </span>
                                    </div>
                                    <div class="mt-2">
                                        <strong>Today's SMS:</strong>
                                        <field name="total_messages_sent" />
                                    </div>
                                </div>
                                <div class="col-6">
                                    <h4 class="text-primary"><i class="fa fa-commenting-o" /> SMS
                                        Config</h4>
                                    <div class="mt-3">
                                        <strong>Twilio Number:</strong>
                                        <field name="twilio_number" />
                                    </div>
                                    <div class="mt-2">
                                        <strong>SID:</strong>
                                        <small class="text-muted">
                                            <field name="account_sid" />
                                        </small>
                                    </div>
                                </div>
                            </div>

                            <hr />
                            <div class="d-flex justify-content-between align-items-center">
                                <span><i class="fa fa-clock-o" /> Last Verified: <field
                                        name="last_tested" /></span>
                                <button name="action_disconnect" string="Disconnect &amp; Reset"
                                    type="object" class="btn btn-outline-danger btn-sm" />
                            </div>

                        </div>
                    </div>
                </sheet>
            </form>
        </field>
    </record>

    <record id="action_twilio_config_server" model="ir.actions.server">
        <field name="name">Twilio Settings</field>
        <field name="model_id" ref="model_twilio_config" />
        <field name="state">code</field>
        <field name="code">
            action = model.action_open_settings()
        </field>
    </record>
</odoo> 